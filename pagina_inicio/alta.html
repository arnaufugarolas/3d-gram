<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nuevo 3D-Gram</title>
    <link href="../css/alta.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-firestore.js"></script>
    <script src="../js/config.js"></script>
    <script src="../js/firestore.js"></script>
    <script src="../js/storage.js"></script>
</head>
<body>
<div class="upload" id="upload">
    <form name="uploadForm" id="uploadform" method="POST" onsubmit="return validar_upload();" action="inicio.html">
        <div>
            <label for="upload_titulo" class="letras">Títol:</label>
            <div class="col-8">
                <input type="text" class="input" id="upload_titulo" required>
            </div>
        </div>
        <div>
            <label for="upload_descripcion" class="letras">Contingut:</label>
            <div class="col-8">
                <textarea name="contenido" required cols="40" rows="5" class="input" id="upload_descripcion"></textarea>
            </div>
        </div>
        <div>
            <label for="upload_img" class="letras">Imatge del disseny 3D:</label>
            <input type="file" required accept="image/*" class="field-file" id="upload_img">
            <label for="upload_img">Escolleix la Imatge .. </label>
        </div>
        <div>
            <label for="upload_design" class="letras">Diseny3D:</label>
            <input type="file" required accept=".stl" class="field-file" id="upload_design">
            <label for="upload_design">Escolleix el Disseny-3D .. </label>
        </div>
        <div>
            <div class="botoncito">
                <button type="submit" id="guardado" class="botonletra">Penjar publicació</button>
            </div>
        </div>
    </form>
</div>

</body>
<script>
    function validar_upload() {
        event.preventDefault()

        const stl = new RegExp('^.*.stl$');
        const img = new RegExp('^image/..*');

        if (!img.test(document.getElementById("upload_img").files[0].type)) {
            document.getElementById("upload_img").setCustomValidity("Nomes pots pujar imatges");
            return false
        }

        if (!stl.test(document.getElementById("upload_design").files[0].name)) {
            document.getElementById("upload_design").setCustomValidity("Nomes pots pujar arxius stl");
            return false
        }

        db.collection("post").add({
            //user: db.doc('users/' + auth.O).ref,
            //user: db.collection('users').doc(auth.O).ref,
            title: document.getElementById("upload_descripcion").value,
            description: document.getElementById("upload_descripcion").value,
            image: "images/uploads/algo",
            design: "designs/uploads/algo",
            date: firebase.firestore.FieldValue.serverTimestamp(),
        })

        //var imagenRef = firebase.storage().ref("images/" + document.getElementById("upload_img").files[0].name);

        //imagenRef.put(document.getElementById("imagen").files[0]);





    }

</script>
</html>